<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Web Mapping Template</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="img/logo.ico?" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Quicksand|Krona+One|Titillium+Web|Righteous" rel="stylesheet">
    <style>
        html, body { width: 100%; height: 100%; margin: 0; background: #fff; font-family: Quicksand}
        /*#map { width: 100%; height: 75%; margin: 0; background: #fff; }*/

        nav{
            z-index: 2000;
            font-size: larger;
        }

        .bg-custom {
            /*background-color: rgba(109, 63, 15, 0.8);*/
            background: linear-gradient(to bottom right, #cc8740, rgba(255, 205, 92, 0.89));
        }

        #map {
            position: fixed;
            top: 0;
            bottom: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            z-index:1;     /*a larger z-index than the container*/
            display: block;
            overflow-x: hidden;
            overflow-y: hidden;
            background-color: #f5f5f5;
        }

        .info-panel {
            line-height: 16px;
            width: 290px;
            position: absolute;
            z-index: 1000;
            left: 10px;
            bottom: 2%;
            color: #070707;
            padding: 6px 8px;
            background: rgba(243, 243, 243, 0.73);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info-panel i {
            width: 16px;
            height: 14px;
            line-height: 18px;
            float: left;
            margin-top: 2px;
            margin-right: 8px;
            opacity: 0.7;
        }
        .info-panel p {
            font-size: 12px;
            line-height: 16px;
            margin: 0;
        }

        .droplist {
            position: absolute;
            z-index: 1000;
        }

        li.dropdown:last-child .dropdown-menu {
            right: 0;
            left: auto;
        }
        .btn-dark{
            background-color: #fbf9cf;
            color: #1f1f1f;

        }
        .btn-dark:hover {
            background-color: #f3d885;
            color: #1f1f1f;
        }

        .btn-light{
            background-color: #f7ebb2;
            color: #1f1f1f;

        }
        .btn-light:hover {
            background-color: #ffcd5c;
            color: #fff4be;
        }

        .btn-alert{
            background-color: #f3d885;
            color: #1f1f1f;

        }
        .btn-alert:hover {
            background-color: #cc8740;
            color: #fff4be;
        }
    </style>
    <!--add required stylesheets-->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <!--<script src="https://unpkg.com/leaflet-swoopy"></script>-->
    <script src="js/Leaflet.SwoopyArrow-customized.js"></script>
    <script src="assets/kits.js"></script>

</head>
<body>
<!--add a Bootstrap navbar-->
<nav class="navbar navbar-expand-lg navbar-light bg-custom">

    <!--<div class="container-fluid">-->
    <!-- Brand and toggle get grouped for better mobile display -->
    <a class="navbar-brand" href="index.html">
        <!--convert the style value to a class and then add the class to the css file.-->
        <img src="img/logo.svg"  width="10%" class="d-inline-block align-top">
    </a>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">
        <!--Create class ml-auto for the navbar items you want on the right.-->

        <ul class="navbar-nav ml-auto">

            <!--a drop-down menu-->
            <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
            </li>
            <!--a simple top bar link-->
            <li class="nav-item">
                <a class="nav-link" href="map.html">Nexus Map</a>
            </li>

            <li>
                <a class="nav-link" href="force.html"> <i class="fa fa-seedling"></i></i>&nbsp;&nbsp;<span>3D Network</span></a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="sankey.html">Sankey</a>
            </li>
            <!--an about page-->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" >About</a>
                <div class="dropdown-menu" >
                    <!--use flag icons ??  or insert small thumbnail photo of flag-->
                    <a class="dropdown-item" href="about-us.html"> Website & Data</a>
                    <a class="dropdown-item" href="http://geoviz.ceoas.oregonstate.edu/neocarto/"> Neocarto</a>
                    <a class="dropdown-item" href="https://github.com/jakobzhao/geog4572"> GEOG 4/572 </a>
                </div>
            </li>
        </ul>
        <!--<nav class="navbar navbar-dark bg-custom">-->
            <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">-->
                <!--<span class="navbar-toggler-icon"></span>-->
            <!--</button>-->
        <!--</nav>-->
    </div>
</nav>
<!--NAV BAR FINISHED-->
<!--NAV BAR FINISHED-->
<!--NAV BAR FINISHED-->
<!--NAV BAR FINISHED-->
<!--NAV BAR FINISHED-->
<!--NAV BAR FINISHED-->
<!--NAV BAR FINISHED-->


<!--map container-->
<div id="map" class="map"></div>


<!--LEGEND info panel-->
<div class="info-panel">
    <h4>Food-Drought Nexus</h4>
    <p><b> Migration of Major Cereals </b></p><br/>
    <!-- legend patch items -->
    <table style="width:100%">
        <tr>
            <td><i style="background: #fbf9cf"></i> <p> Barley </p></td>
            <td><i style="background: #f7ebb2"></i> <p> Maize </p></td>
        </tr>
        <tr>
            <td><i style="background: #f3d885"></i> <p> Millet </p></td>
            <td><i style="background: #ffcd5c"></i> <p> Rice </p></td>
        </tr>
        <tr>
            <td><i style="background: #cc8740"></i> <p> Wheat </p></td>
            <td>
                <!--poly line feature-->
                <!--svg editor http://jxnblk.com/paths/-->
                <i><svg width="16" height="16">
                    <path d='M0 16 L16 16 L16 0 L8 10 L0 0 Z' style="stroke-dasharray:2; stroke:rgb(0,45,129); stroke-width:3px;fill:rgba(9,73,255,0.78)"></path>
                </svg></i> <p> Country Area </p>
            </td>
        </tr>
        <tr>
            <td>    <!--no data symbol-->
                <i><svg width="16" height="16" data-reactid=".0.1.1.0.0.1:$=11:$1.0.0.$masked.0">
                    <pattern id="diagonalHatch" patternUnits="userSpaceOnUse" width="4" height="4">
                        <path d="M-1,1 l2,-2
       M0,4 l4,-4
       M3,5 l2,-2" style="stroke:black; stroke-width:0.5px" />
                    </pattern>
                    <rect x="0" y="0" width="100%" height="100%" fill="url(#diagonalHatch)"/>
                </svg></i> <p> No data </p></td>
            <td><!--drought tile image-->
            <i><img src="img/droughticon.png" width="16"></i>
                <p> Drought Map</p></td>
        </tr>
    </table>
    <!--place holder-->
    <br/>
    <img src="img/dscale.PNG" width="200">
    <br/>
    <p> </p>
    <p> Click on a country to show trade arrows/pick from the drop-down menu of countries. </p>
    <p> Change the year of the basemap to see how drought has affected the year. </p>


    <!--<div class="btn-group">-->
        <!--<div class="btn-group">-->
            <!--<button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown">-->
                <!--Grain <span class="caret"></span></button>-->
            <!--<ul class="dropdown-menu" role="menu">-->
                <!--<li><a href="#">Barley</a></li>-->
                <!--<li><a href="#">Maize</a></li>-->
                <!--<li><a href="#">Millet</a></li>-->
                <!--<li><a href="#">Rice</a></li>-->
                <!--<li><a href="#">Wheat</a></li>-->
                <!--<div class="dropdown-divider"></div>-->
                <!--<a class="dropdown-item" href="#">All</a>-->
            <!--</ul>-->
        <!--</div>-->


        <select id="country">
            <option value="Barley">China</option>
            <option value="Maize">India</option>
            <option value="Millet">United States</option>
            <option value="Rice">Brazil</option>
            <option value="Wheat">Pakistan</option>
            <option value="Barley">Nigeria</option>
            <option value="Maize">India</option>
            <option value="Millet">Bangladesh</option>
            <option value="Millet">Russia</option>
            <option value="Millet">Mexico</option>
            <option value="Rice">Japan</option>
            <option value="Wheat">Ethiopia</option>
            <option value="Barley">Phillipines</option>
            <option value="Rice">Egypt</option>
            <option value="Wheat">Viet Nam</option>
            <option value="Barley">DR Congo</option>
            <option value="Maize">Germany</option>
            <option value="Millet">Iran</option>
            <option value="Rice">Turkey</option>
            <option value="Wheat">Thailand</option>
        </select>

        <select id="grain">
            <option value="Barley">Barley</option>
            <option value="Maize">Maize</option>
            <option value="Millet">Millet</option>
            <option value="Rice">Rice</option>
            <option value="Wheat">Wheat</option>
        </select>


        <select id="year">
            <option value="1980">1980</option>
            <option value="1985">1985</option>
            <option value="1990">1990</option>
            <option value="1995">1995</option>
            <option value="2000">2000</option>
            <option value="2005">2005</option>
            <option value="2010">2010</option>
            <option value="2011">2011</option>
            <option value="2012">2012</option>
            <option value="2013">2013</option>
        </select>
    </div>



</div>











<script type="text/javascript">



    var map = L.map("map", {zoomControl: false}).fitBounds([
	    [60, -95],
	    [-40, 80]
    ]);
    // construct a base map in light color.md.
    var layergroup =L.layerGroup().addTo(map);
    L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png').addTo(map);


   var drought =  L.tileLayer(' http://climate.calit2.uci.edu/MERRA/tile_mercator/SPI19807_dry/tile_{z}_{x}-{y}.png').addTo(map);
   var droughtw = L.tileLayer(' http://climate.calit2.uci.edu/MERRA/tile_mercator/SPI19807_wet/tile_{z}_{x}-{y}.png').addTo(map);



    $("#year").on("change", function(){
// alert($(this).val());
        var year = $(this).val();
        drought.remove();
        drought = L.tileLayer(' http://climate.calit2.uci.edu/MERRA/tile_mercator/SPI' + year + '7_dry/tile_{z}_{x}-{y}.png');
        drought.addTo(map);
    });

    $("#year").on("change", function(){
// alert($(this).val());
        var year = $(this).val();
        droughtw.remove();
        droughtw = L.tileLayer(' http://climate.calit2.uci.edu/MERRA/tile_mercator/SPI' + year + '7_wet/tile_{z}_{x}-{y}.png');
        droughtw.addTo(map);
    });




    $("#grain").on("change", function(){
	    layergroup.clearLayers();
	    var grain = $(this).val();

        grain = 40;
	    for (let i=0;i<kits.features.length;i++) {

		    if (kits.features[i].properties.lat > grain) {

			    lng = kits.features[i].geometry.coordinates[0];
			    lat = kits.features[i].geometry.coordinates[1];


			    layergroup.addLayer( L.swoopyArrow([45.505374, -122.978524], [lat, lng], {
				    labelFontSize: 12,
				    iconAnchor: [20, 10],
				    iconSize: [30, 16],
				    color: '#ffcd5c',
				    opacity: 0.7,
				    weight:'3'
			    }));
		    }


	    }

	    // layergroup2.addTo(map2);

// // alert($(this).val());
// 	    var grain = $(this).val();
// 	    drought.remove();
// 	    drought = L.tileLayer(' http://climate.calit2.uci.edu/MERRA/tile_mercator/SPI' + year + '2_dry/tile_{z}_{x}-{y}.png');
// 	    drought.addTo(map);





    });






    function style() {
        return {
            //fillColor: setColor(feature.properties.NAME),
            fillOpacity: 0.1,
            weight: 1,
            opacity: 1,
            color: 'blue',
            dashArray: '10'
        };
    }

    var countries = null;
    countries = L.geoJson.ajax("assets/world_simplified.geojson", {
        style: style
    }).addTo(map); //...geojson, ([style: style}].addTo...





//Need function to pull lat long of countries by selected button name and map-click, to insert into below function.
    // Add a function to differ line 'weight' (thickness) based on Value (tonnes).
    // L.swoopyArrow([33, -98], [53.525, 14.41], {
    //     color: "#ffd100",
    //     opacity: 0.7,
    //     weight:'3'
    // }).addTo(map);
    //
    //
    // for(let i=0; i<kits.features.length; i++) {
    //
    //     setTimeout(function () {
    //         lng = kits.features[i].geometry.coordinates[0];
    //         lat = kits.features[i].geometry.coordinates[1];
    //
    //         L.swoopyArrow([-28, 134], [lat, lng], {
    //             labelFontSize: 12,
    //             iconAnchor: [20, 10],
    //             iconSize: [30, 16],
    //             color: '#ffd100',
    //             opacity: 0.7,
    //             weight:'3'
    //         }).addTo(map);
    //         // layergroup2.addLayer( L.marker([lat, lng], {icon: pwbIcon}));
    //
    //     }, 100 * i);
    // }


//CONVERT TO GEOJSON when lat longs are added to datasheet, then rename as data.geojson
//     d3.json('assets/FBS_Country_data.json').then(function(data) {
//
//         //////////////////////////////////////////////////PREP THE DATA////////////////////////////////////////////////////////
//         //create crossfilter passes each feature to the filter. We have to pass it through the crossfilter before we can split up with data using
//         //the .dimensions() method
//         var filter = crossfilter(data.features); //passes the features to the crossfilter
//
//         // groups everything together into one group, this is used to quickly search all of the data at once
//         var all = filter.groupAll();
//
//
//         //Takes each of the records of the dataset and returns each individual line so that they can be used. .dimension() puts
//         // the data into an easily searchable/manipulable format for DC
//         var everything = filter.dimension(function (d) {
//             return d
//         });
//
//         //////////////////////////////////////////////SORT THE DATA///////////////////////////////////////////////////////////
//         //Now that we have our initial data imported and in the right format using crossfilter we now have to sort out the data that we want to display, set up
//         //the chart space and populate the graphs
//
//         //returns the geometry for each feature; this is the points at which each earthquake happened
//         var geomDimension = filter.dimension(function (d) {
//             return d.geometry
//         });
//
//         //defines the categories from magnitude property
//         var valueDimension = filter.dimension(function (d) {
//
//             var value = d.properties.value;
//             valueClass = "> 15";
//
//             if (mag <= 6) {
//                 valueClass = "<6"
//             } else if (mag > 1.2 && mag <= 15) {
//                 valueClass = "1-15"
//             } else {
//                 valueClass = ">15"
//             }
//             return valueClass;
//         });
//     })



</script>
</body>
</html>