<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Force Graph - NIGERIA</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--add favicon for the web page-->

    <link rel="shortcut icon" href="img/logo.ico?" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Quicksand|Krona+One|Titillium+Web|Righteous" rel="stylesheet">
    <link href="css/force.css" rel="stylesheet">
    <style>
    </style>
    <!--add required stylesheets-->
    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/three-spritetext"></script>
    <script src="https://unpkg.com/3d-force-graph@1.31.4/dist/3d-force-graph.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

</head>
<body onclick="myFunction()">
<!--add a Bootstrap navbar-->
<nav class="navbar navbar-expand-lg navbar-light bg-custom">

    <!--<div class="container-fluid">-->
    <!-- Brand and toggle get grouped for better mobile display -->
    <a class="navbar-brand" href="index.html">
        <!--convert the style value to a class and then add the class to the css file.-->
        <img src="img/logo.svg"  width="15%" class="d-inline-block align-top">
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <!--Create class ml-auto for the navbar items you want on the right.-->

        <ul class="navbar-nav ml-auto">

            <!--a drop-down menu-->
            <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
            </li>
            <!--a simple top bar link-->
            <li class="nav-item">
                <a class="nav-link" href="map.html">Nexus Map</a>
            </li>


            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="force.html" role="button" data-toggle="dropdown" >3D Network</a>
                <div class="dropdown-menu" >
                    <a class="dropdown-item" href="force.html"><b>Top 10 Populations</b></a>
                    <a class="dropdown-item dropdown-toggle dropdown-submenu" href="force.html"><b>Filter Country</b></a>
                    <ul>
                        <a class="dropdown-item" href="force-chi.html">1. China</a>
                        <a class="dropdown-item" href="force-ind.html">2. India</a>
                        <a class="dropdown-item" href="force-usa.html">3. United States</a>
                        <a class="dropdown-item" href="force-ina.html">4. Indonesia</a>
                        <a class="dropdown-item" href="force-bra.html">5. Brazil</a>
                        <a class="dropdown-item" href="force-pak.html">6. Pakistan</a>
                        <a class="dropdown-item" href="force-nig.html">7. Nigeria</a>
                        <a class="dropdown-item" href="force-ban.html">8. Bangladesh</a>
                        <a class="dropdown-item" href="force-rus.html">9. Russia</a>
                        <a class="dropdown-item" href="force-mex.html">10. Mexico</a>
                    </ul>
                </div>
            </li>

            <!--an about page-->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" >About</a>
                <div class="dropdown-menu" >
                    <!--use flag icons ??  or insert small thumbnail photo of flag-->
                    <a class="dropdown-item" href="about-us.html"> Website & Data</a>
                    <a class="dropdown-item" href="http://geoviz.ceoas.oregonstate.edu/neocarto/"> Neocarto</a>
                    <a class="dropdown-item" href="https://github.com/jakobzhao/geog4572"> GEOG 4/572 </a>
                </div>
            </li>
        </ul>
        <!--<nav class="navbar navbar-dark bg-custom">-->
        <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">-->
        <!--<span class="navbar-toggler-icon"></span>-->
        <!--</button>-->
        <!--</nav>-->
    </div>
</nav>
<!--CONTENT PAGE HERE-->
<!--CONTENT PAGE HERE-->
<!--CONTENT PAGE HERE-->
<!--CONTENT PAGE HERE-->
<!--CONTENT PAGE HERE-->


<div class="overlay-desc">
    <h1 id="h1a">Trade Links for Nigeria</h1></div>
<!--<div class="overlay-desc-sub">-->
<!--<p>d3 Forcegraph</p></div>-->



<div id="3d-graph"></div>



<!--LEGEND info panel-->
<div class="info-panel">
    <h1>Trade Network</h1>
    <h6><b> d3 Force-Directed Graph </b></h6>
    <!-- legend patch items -->
    <!--place holder-->
    <br>
    <i class="fa fa-mouse-pointer" style="font-size:20px;color:#5e3e1d;"></i><div> Drag nodes to examine relationships.</div><br>
    <i class="fa fa-ellipsis-h" style="font-size:20px;color:#ffcd5c;"></i><div> Particle speed is directional and proportional to amount traded (tonnes). </div><br>


    <div class="btn-group">
        <div class="btn-group">
            <button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown">
                Nigeria <span class="caret"></span></button>
            <ul class="dropdown-menu max" role="menu">
                <li><a href="force-chi.html">China</a></li>
                <li><a href="force-ind.html">India</a></li>
                <li><a href="force-usa.html">United States</a></li>
                <li><a href="force-ina.html">Indonesia</a></li>
                <li><a href="force-bra.html">Brazil</a></li>
                <li><a href="force-pak.html">Pakistan</a></li>
                <li><a href="force-nig.html">Nigeria</a></li>
                <li><a href="force-ban.html">Bangladesh</a></li>
                <li><a href="force-rus.html">Russia</a></li>
                <li><a href="force-mex.html">Mexico</a></li>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="force.html">All</a>
            </ul>


            <!--<select id="country">-->
            <!--<option value="All">All Selected</option>-->
            <!--<option value="China">China</option>-->
            <!--<option value="India">India</option>-->
            <!--<option value="United States">United States</option>-->
            <!--<option value="Indonesia">Indonesia</option>-->
            <!--<option value="Brazil">Brazil</option>-->
            <!--<option value="Pakistan">Pakistan</option>-->
            <!--<option value="Nigeria">Nigeria</option>-->
            <!--<option value="Bangladesh">Bangladesh</option>-->
            <!--<option value="Russia">Russia</option>-->
            <!--<option value="Mexico">Mexico</option>-->
            <!--<option value="Japan">Japan</option>-->
            <!--<option value="Ethiopia">Ethiopia</option>-->
            <!--<option value="Phillipines">Phillipines</option>-->
            <!--<option value="Egypt">Egypt</option>-->
            <!--<option value="Viet Nam">Viet Nam</option>-->
            <!--<option value="DR Congo">DR Congo</option>-->
            <!--<option value="Germany">Germany</option>-->
            <!--<option value="Iran">Iran</option>-->
            <!--<option value="Turkey">Turkey</option>-->
            <!--&lt;!&ndash;<option value="Thailand">Thailand</option>&ndash;&gt;-->
            <!--</select>-->

        </div>
    </div>
</div>


<!--STREAM GRAPH-->
<div class="info-panel-l">
    <h2 class="h2info">Nigeria Cereal Imports</h2>
    <h3><b>1965-2013</b></h3>
    <h6 align="center"><i class="fa fa-mouse-pointer" style="font-size:20px;color:#5e3e1d;"></i>
        <b> (Mouse-over to see Grain Type) </b></h6>
    <h5 align="center">Year</h5>
    <!-- legend patch items -->
    <!--place holder-->
    <div class="stream"></div>

    <h4 align="center" id="major"><b>Grain Type</b></h4>


    <div class="btn-group">
        <div class="btn-group">
            <button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown">
                Nigeria <span class="caret"></span></button>
            <ul class="dropdown-menu max" role="menu">
                <li><a href="force-chi.html">China</a></li>
                <li><a href="force-ind.html">India</a></li>
                <li><a href="force-usa.html">United States</a></li>
                <li><a href="force-ina.html">Indonesia</a></li>
                <li><a href="force-bra.html">Brazil</a></li>
                <li><a href="force-pak.html">Pakistan</a></li>
                <li><a href="force-nig.html">Nigeria</a></li>
                <li><a href="force-ban.html">Bangladesh</a></li>
                <li><a href="force-rus.html">Russia</a></li>
                <li><a href="force-mex.html">Mexico</a></li>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="force.html">All</a>
            </ul>
        </div>
    </div>
</div>

        <script>

            var top10 = 'assets/imports.json';
            var China = '';
            var India = '';
            var UnitedStates = '';
            var Brazil = '';
            var Pakistan = '';
            var Nigeria = '';
            var India = '';
            var Bangladesh = '';
            var Russia = '';
            var Mexico = '';





            const distance = 1000;
            const Graph = ForceGraph3D()
            (document.getElementById('3d-graph'))
                .jsonUrl(top10)
                // .nodeLabel('id')
                .nodeAutoColorBy('group')
                .linkDirectionalParticles("value")
                .linkDirectionalParticleSpeed(d => d.value * 0.001)
                .enableNodeDrag(true)
                .cameraPosition({ z: distance })
                .nodeThreeObject(node => {
                    const sprite = new SpriteText(node.id);
                    sprite.color = node.color;
                    sprite.textHeight = 15;
                    return sprite;
                });


            Graph.d3Force('charge').strength(-600);


            //camera orbit
            let angle = 0;
            setInterval(() => {
                Graph.cameraPosition({
                    x: distance * Math.sin(angle),
                    z: distance * Math.cos(angle)
                });
                angle += Math.PI / 300;
            }, 40);


            document.getElementById("3d-graph").onclick = function(event) {myFunction(event)}
            function myFunction() {

                //var camera = $("cameraPosition").stop();





                $(window).on("resize", function () {
                    var width = $(window).width();
                    Graph.width(width)
                })

                //
                // $("#country").change(function () {
                //     $("#3d-graph").remove();

                //if/for statement for each of 10 countries; if China, load force-china.html

// alert($(this).val());
//          var country = $(this).val();
//          top10.remove();
//          add();
//         droughtw = L.tileLayer(' http://climate.calit2.uci.edu/MERRA/tile_mercator/SPI' + year + '7_wet/tile_{z}_{x}-{y}.png');
//         droughtw.addTo(map);
            }

            d3.csv('assets/stream_import_nig.csv', function(err, d){
                if(err) console.log(err);
                console.log(d)

                var nested_data = d3.nest()
                    .key(function(d) { return d.Year; })
                    .entries(d);

                console.log(nested_data);

                var mqpdata = nested_data.map(function(d){
                    var obj = {
                        yearobj: new Date(d.key, 0, 1)
                    }

                    d.values.forEach(function(v){
                        obj[v.Item] = v.Value;
                        console.log(d.Value)
                    })

                    return obj;
                })

                buildStreamGraph(mqpdata);

            });


            function buildStreamGraph(mqpdata) {
                var data = mqpdata;


                var stack = d3.stack()
                    .keys(["Barley", "Maize", "Millet", "Rice", "Wheat"])
                    .order(d3.stackOrderNone)
                    .offset(d3.stackOffsetWiggle);

                var series = stack(data);

                var width = 350,
                    height = 250;

                var x = d3.scaleTime()
                    .domain(d3.extent(data, function (d) {
                        return d.yearobj;
                    }))
                    .range([25, width-50]);

// setup axis
                var xAxis = d3.axisBottom(x);

                var y = d3.scaleLinear()
                    .domain([0, d3.max(series, function (layer) {
                        return d3.max(layer, function (d) {
                            return d[0] + d[1];
                        });
                    })])
                    .range([height / 2.6, 50]);

                var color = d3.scaleLinear()
                    .range(["#a96920", "#ffcd5c"]);

                // var color = d3.scaleOrdinal(d3.schemeCategory10); //color = d3.interpolateCool/Warm/Plasma etc., https://github.com/d3/d3-scale-chromatic for other colors

                var area = d3.area()
                    .x(function (d) {
                        console.info('in area function', d);
                        return x(d.data.yearobj);
                    })
                    .y0(function (d) {
                        return y(d[0]);
                    })
                    .y1(function (d) {
                        return y(d[1]);
                    })
                    .curve(d3.curveBasis);

                var tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip");

                var svg = d3.select(".stream").append("svg")
                    .attr("width", width)
                    .attr("height", height);

                svg.selectAll("path")
                    .data(series)
                    .enter().append("path")
                    .attr("d", area)
                    .style("fill", function () {
                        return color(Math.random());
                    })
                    .on('mouseover', function (d) {
                        d3.select(this).style('fill', d3.rgb(d3.select(this).style("fill")).brighter());
                        d3.select("#major").text("Grain: " + d.key);
                        tooltip.transition()
                            .duration(700)
                            .style("opacity", 1);
                        tooltip.html(d.key)
                            .style("left", (d3.event.pageX + 5) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on('mouseout', function (d) {
                        d3.select(this).style('fill',
                            d3.rgb(d3.select(this).style("fill")).darker());
                        d3.select("#major").text("Grain: ");
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });

                svg.append("g")
                    .attr("class", "axis axis--x")
                    .attr("transform", "translate(0," + (height) + ")")
                    .call(xAxis);

                var xAxisGroup = svg.append("g").call(xAxis);

            }


        </script>
</body>
</html>